function getPasteEvent(){var a=document.createElement("input"),b="onpaste";return a.setAttribute(b,""),"function"==typeof a[b]?"paste":"input"}var pasteEventName=getPasteEvent()+".mask",ua=navigator.userAgent,iPhone=/iphone/i.test(ua),android=/android/i.test(ua),caretTimeoutId;$.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},$.fn.extend({caret:function(a,b){var c;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof a?(b="number"==typeof b?b:a,this.each(function(){this.setSelectionRange?this.setSelectionRange(a,b):this.createTextRange&&(c=this.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select())})):(this[0].setSelectionRange?(a=this[0].selectionStart,b=this[0].selectionEnd):document.selection&&document.selection.createRange&&(c=document.selection.createRange(),a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length),{begin:a,end:b})},unmask:function(){return this.trigger("unmask")},mask:function(a,b){var c,d,e,f,g,h;return!a&&this.length>0?(c=$(this[0]),c.data($.mask.dataName)()):(b=$.extend({placeholder:$.mask.placeholder,completed:null},b),d=$.mask.definitions,e=[],f=h=a.length,g=null,$.each(a.split(""),function(a,b){"?"==b?(h--,f=a):d[b]?(e.push(new RegExp(d[b])),null===g&&(g=e.length-1)):e.push(null)}),this.trigger("unmask").each(function(){function c(a){for(;++a<h&&!e[a];);return a}function i(a){for(;--a>=0&&!e[a];);return a}function j(a,d){var f,i;if(!(0>a)){for(f=a,i=c(d);h>f;f++)if(e[f]){if(!(h>i&&e[f].test(r[i])))break;r[f]=r[i],r[i]=b.placeholder,i=c(i)}o(),q.caret(Math.max(g,a))}}function k(a){var d,f,g,i;for(d=a,f=b.placeholder;h>d;d++)if(e[d]){if(g=c(d),i=r[d],r[d]=f,!(h>g&&e[g].test(i)))break;f=i}}function l(a){var b,d,e,f=a.which;8===f||46===f||iPhone&&127===f?(b=q.caret(),d=b.begin,e=b.end,e-d===0&&(d=46!==f?i(d):e=c(d-1),e=46===f?c(e):e),n(d,e),j(d,e-1),a.preventDefault()):27==f&&(q.val(s),q.caret(0,p()),a.preventDefault())}function m(a){var d,f,g,i=a.which,l=q.caret();a.ctrlKey||a.altKey||a.metaKey||32>i||i&&(l.end-l.begin!==0&&(n(l.begin,l.end),j(l.begin,l.end-1)),d=c(l.begin-1),h>d&&(f=String.fromCharCode(i),e[d].test(f)&&(k(d),r[d]=f,o(),g=c(d),android?setTimeout($.proxy($.fn.caret,q,g),0):q.caret(g),b.completed&&g>=h&&b.completed.call(q))),a.preventDefault())}function n(a,c){var d;for(d=a;c>d&&h>d;d++)e[d]&&(r[d]=b.placeholder)}function o(){q.val(r.join(""))}function p(a){var c,d,i=q.val(),j=-1;for(c=0,pos=0;h>c;c++)if(e[c]){for(r[c]=b.placeholder;pos++<i.length;)if(d=i.charAt(pos-1),e[c].test(d)){r[c]=d,j=c;break}if(pos>i.length)break}else r[c]===i.charAt(pos)&&c!==f&&(pos++,j=c);return a?o():f>j+1?(q.val(""),n(0,h)):(o(),q.val(q.val().substring(0,j+1))),f?c:g}var q=$(this),r=$.map(a.split(""),function(a,c){return"?"!=a?d[a]?b.placeholder:a:void 0}),s=q.val();q.data($.mask.dataName,function(){return $.map(r,function(a,c){return e[c]&&a!=b.placeholder?a:null}).join("")}),q.attr("readonly")||q.one("unmask",function(){q.unbind(".mask").removeData($.mask.dataName)}).bind("focus.mask",function(){clearTimeout(caretTimeoutId);var b;s=q.val(),b=p(),caretTimeoutId=setTimeout(function(){o(),b==a.length?q.caret(0,b):q.caret(b)},10)}).bind("blur.mask",function(){p(),q.val()!=s&&q.change()}).bind("keydown.mask",l).bind("keypress.mask",m).bind(pasteEventName,function(){setTimeout(function(){var a=p(!0);q.caret(a),b.completed&&a==q.val().length&&b.completed.call(q)},0)}),p()}))}});